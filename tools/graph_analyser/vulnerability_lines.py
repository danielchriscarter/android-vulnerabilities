#!/usr/bin/env python3

# Copyright (C) Daniel Carter 2019
# Licensed under the 2-clause BSD licence

# Plots a line per discovered Android vulnerability

import os
import json
from datetime import datetime, date

import matplotlib.pyplot as plt

VULNERABILITY_PATH = '../../input/vulnerabilities/'
KEYS = ['Reported_on', 'Fixed_on', 'Fix_released_on']
dates = []

for filename in os.listdir(VULNERABILITY_PATH):
    #print('Processing', filename)
    if filename == 'template.json':
        continue
    if not filename.endswith('.json'):
        continue
    with open(VULNERABILITY_PATH + filename, 'r') as f:
        vulnerability = json.load(f)
        for key in KEYS:
            if len(vulnerability[key]) != 0:
                inner = vulnerability[key][0]
                if isinstance(inner, list) and len(inner) != 0:
                    sdate = inner[0]
                    dates.append(datetime.strptime(sdate, '%Y-%m-%d').date())
                    break

plt.rc('font', size=20)

for date in dates:
    #print(date, ':', dates.count(date))
    plt.axvline(x=date)

plt.title('Android vulnerability public disclosure dates')
plt.xlabel('Date')
# Hide y-axis labels
plt.yticks([])
plt.show()
